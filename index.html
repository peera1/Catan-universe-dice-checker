<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>מחשבון קוביות - התפלגות סכומים ובדיקת הוגנות</title>
    <!-- Meta Description for SEO -->
    <meta name="description" content="כלי אינטראקטיבי לבדיקת הוגנות קוביות. הזינו את תוצאות זריקות הקוביות וצפו בהתפלגות הסכומים בגרף פעמון גאוס. עקבו אחר התפלגות התוצאות ובדקו האם הקוביות שלכם הוגנות.">
    <meta name="keywords" content="קוביות, התפלגות, פעמון גאוס, בדיקת הוגנות, רנדומליות, משחקי קוביות, סטטיסטיקה, מחשבון קוביות">

    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        /* CSS Reset and Global Styles */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Heebo', sans-serif;
            background-color: #1a202c; /* Dark background */
            color: #e2e8f0; /* Light text */
            display: flex;
            justify-content: center;
            align-items: flex-start; /* Align at top, not center, for better scroll on smaller screens */
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden; /* Prevent horizontal scroll */
        }

        #app-container {
            background-color: #2d3748; /* Slightly lighter dark background for container */
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
            padding: 35px;
            width: 100%;
            max-width: 900px;
            text-align: center;
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        h1 {
            font-size: 2.8em;
            color: #63b3ed; /* Accent color */
            margin-bottom: 15px;
            text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.3);
        }

        .description-text { /* New class for the description paragraph */
            font-size: 1.1em;
            line-height: 1.6;
            margin-bottom: 20px;
            color: #cbd5e0;
        }

        /* Input Section */
        .input-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        .dice-inputs {
            display: flex;
            gap: 15px;
            flex-wrap: wrap; /* Allow wrapping on small screens */
            justify-content: center;
        }

        .dice-input-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .dice-input-group label {
            font-size: 1.1em;
            color: #90cdf4;
        }

        /* --- NEW: LTR direction for numbers in input fields --- */
        .dice-input-group input[type="number"] {
            width: 80px;
            padding: 12px;
            border: 2px solid #4a5568;
            border-radius: 8px;
            background-color: #4a5568;
            color: #e2e8f0;
            font-size: 1.4em;
            text-align: center;
            direction: ltr; /* Set direction to Left-to-Right for numbers */
            -moz-appearance: textfield; /* Hide arrows for Firefox */
            appearance: textfield;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        .dice-input-group input[type="number"]:focus {
            outline: none;
            border-color: #63b3ed;
            box-shadow: 0 0 0 3px rgba(99, 179, 237, 0.5);
        }

        /* Style for invalid input */
        .dice-input-group input[type="number"].invalid-input {
            border-color: #e53e3e; /* Red border */
            box-shadow: 0 0 0 3px rgba(229, 62, 62, 0.5);
        }

        /* Hide arrows for Chrome, Safari, Edge */
        .dice-input-group input::-webkit-outer-spin-button,
        .dice-input-group input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        button {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease, opacity 0.3s ease;
        }

        button#rollButton {
            background-color: #63b3ed;
            color: #1a202c;
            box-shadow: 0 5px 15px rgba(99, 179, 237, 0.4);
        }

        button#rollButton:hover:not(:disabled) { /* Only hover if not disabled */
            background-color: #4299e1;
            transform: translateY(-2px);
            box-shadow: 0 7px 20px rgba(99, 179, 237, 0.6);
        }

        button:disabled { /* Style for disabled buttons */
            background-color: #4a5568;
            color: #a0aec0;
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
            opacity: 0.7;
        }

        .total-rolls {
            font-size: 1.2em;
            color: #a0aec0;
            margin-top: 20px;
        }
        /* --- NEW: LTR direction for the total rolls number --- */
        #totalRollsDisplay {
            direction: ltr; /* Numbers will display LTR */
            display: inline-block; /* Needed for direction to apply correctly within RTL text */
        }


        /* Chart Section */
        .chart-section {
            margin-top: 30px;
        }

        .chart-container {
            display: flex;
            /* --- CHANGED: Reverse the order of flex items to make 2 appear on the left --- */
            flex-direction: row-reverse; 
            align-items: flex-end; /* Bars grow from bottom */
            justify-content: space-around;
            height: 250px; /* Fixed height for the chart area */
            background-color: #1a202c;
            border-radius: 8px;
            padding: 10px;
            position: relative;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5);
            border: 1px solid #4a5568;
        }

        .chart-bar {
            width: 7%; /* Width for each bar */
            max-width: 60px;
            background-color: #48bb78; /* Green accent for bars */
            border-radius: 5px 5px 0 0; /* Rounded top corners */
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            align-items: center;
            transition: height 0.5s ease-out; /* Smooth animation for height changes */
            min-height: 2px; /* Ensure bar is visible even with 0 height percentage */
            transform-origin: bottom; /* Ensure scale animation works from bottom */
            box-shadow: 0 0 8px rgba(72, 187, 120, 0.5);
        }

        .chart-bar:hover {
            box-shadow: 0 0 15px rgba(72, 187, 120, 0.8);
            transform: scaleY(1.02); /* Slight scale on hover */
        }

        /* --- NEW: LTR direction for numbers in bar labels --- */
        .bar-label {
            position: absolute;
            bottom: -25px; /* Position below the bar */
            color: #cbd5e0;
            font-size: 0.9em;
            font-weight: bold;
            direction: ltr; /* Set direction to Left-to-Right for numbers */
        }

        /* --- NEW: LTR direction for numbers in bar counts --- */
        .bar-count {
            position: absolute;
            top: -20px; /* Position above the bar */
            color: #fff;
            font-size: 0.85em;
            font-weight: bold;
            opacity: 0; /* Hide by default */
            transition: opacity 0.3s ease;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.6);
            direction: ltr; /* Set direction to Left-to-Right for numbers */
        }

        .chart-bar[data-count="0"] .bar-count {
            opacity: 0; /* Ensure count is hidden if 0 */
        }

        .chart-bar:not([data-count="0"]) .bar-count {
            opacity: 1; /* Show count if not 0 */
        }
        
        .chart-bar.active .bar-count {
            opacity: 1; /* Always show count for active/non-zero bars */
        }

        /* Reset Button Specific Styles (smaller and positioned separately) */
        #resetButton {
            background-color: transparent; /* Transparent background */
            color: #a0aec0; /* Lighter color */
            border: 1px solid #4a5568; /* Subtle border */
            padding: 8px 15px; /* Smaller padding */
            font-size: 0.9em; /* Smaller font */
            margin-top: 30px; /* Space from the rest of the content */
            align-self: flex-end; /* Align to the end of the container */
            border-radius: 6px;
            box-shadow: none; /* No strong shadow */
        }

        #resetButton:hover {
            background-color: #4a5568; /* Slight background on hover */
            color: #fff;
            transform: none; /* No transform */
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
        }


        /* Responsive adjustments */
        @media (max-width: 768px) {
            h1 {
                font-size: 2.2em;
            }
            .description-text {
                font-size: 1em;
            }
            .input-section {
                flex-direction: column;
            }
            .dice-inputs {
                flex-direction: column;
                align-items: center;
            }
            .chart-bar {
                width: 7%; /* Adjust width for smaller screens */
                max-width: 40px;
            }
            .chart-container {
                height: 200px;
            }
            button#rollButton {
                width: 100%;
                max-width: 250px;
            }
            #resetButton {
                align-self: center; /* Center the reset button on small screens */
            }
        }

        @media (max-width: 480px) {
            #app-container {
                padding: 20px;
            }
            h1 {
                font-size: 1.8em;
            }
            .chart-bar {
                width: 7%; /* Further adjust width */
                max-width: 30px;
            }
            .bar-label, .bar-count {
                font-size: 0.75em;
            }
        }
    </style>
</head>
<body>
    <div id="app-container">
        <header>
            <h1>מחשבון קוביות: בדיקת הוגנות באמצעות התפלגות סכומים</h1>
            <p class="description-text">
                הזינו את התוצאות של שתי הקוביות שזרקתם. המערכת תחשב את הסכום ותעדכן את גרף התפלגות הסכומים. 
                ככל שתבצעו יותר זריקות, כך תוכלו לראות טוב יותר האם התוצאות מתקרבות להתפלגות התיאורטית של פעמון גאוס, 
                מה שיכול להעיד על הוגנות הקוביות שלכם.
            </p>
        </header>

        <section class="input-section">
            <div class="dice-inputs">
                <div class="dice-input-group">
                    <label for="die1">קוביה 1 (1-6):</label>
                    <input type="number" id="die1" min="1" max="6" placeholder="?" required>
                </div>
                <div class="dice-input-group">
                    <label for="die2">קוביה 2 (1-6):</label>
                    <input type="number" id="die2" min="1" max="6" placeholder="?" required>
                </div>
            </div>
            <div class="controls">
                <button id="rollButton" disabled>הוסף זריקה</button>
            </div>
            <p class="total-rolls">סה"כ זריקות: <span id="totalRollsDisplay">0</span></p>
        </section>

        <section class="chart-section">
            <h2>התפלגות סכומים</h2>
            <div class="chart-container" id="chartContainer">
                <!-- Chart bars will be generated here by JavaScript -->
            </div>
        </section>

        <!-- Reset Button moved to the bottom of the container -->
        <button id="resetButton">איפוס נתונים</button>
    </div>

    <script>
        // Initialize counts for sums 2 through 12
        // Index 0 and 1 will be unused to easily map sum to index
        let rollCounts = new Array(13).fill(0); 
        let totalRolls = 0;

        // Get DOM elements
        const die1Input = document.getElementById('die1');
        const die2Input = document.getElementById('die2');
        const rollButton = document.getElementById('rollButton');
        const resetButton = document.getElementById('resetButton');
        const totalRollsDisplay = document.getElementById('totalRollsDisplay');
        const chartContainer = document.getElementById('chartContainer');

        // Function to create chart bars dynamically
        function createChartBars() {
            // Loop from 2 to 12. The CSS 'flex-direction: row-reverse' will handle the visual order.
            for (let i = 2; i <= 12; i++) {
                const bar = document.createElement('div');
                bar.className = 'chart-bar';
                bar.id = `sum-${i}`; // Unique ID for each bar
                bar.setAttribute('data-sum', i);
                bar.setAttribute('data-count', 0); // Initial count

                const countSpan = document.createElement('span');
                countSpan.className = 'bar-count';
                countSpan.textContent = '0';

                const labelSpan = document.createElement('span');
                labelSpan.className = 'bar-label';
                labelSpan.textContent = i; // The sum value (2-12)

                bar.appendChild(countSpan);
                bar.appendChild(labelSpan);
                chartContainer.appendChild(bar);
            }
        }

        // Function to render/update the chart
        function renderChart() {
            // Find the maximum count to normalize bar heights
            const maxCount = Math.max(...rollCounts);

            for (let i = 2; i <= 12; i++) {
                const bar = document.getElementById(`sum-${i}`);
                if (bar) {
                    const currentCount = rollCounts[i];
                    let heightPercentage = 0;
                    if (maxCount > 0) {
                        // We use 90% of the container height to leave some padding at the top
                        heightPercentage = (currentCount / maxCount) * 90; 
                    }
                    bar.style.height = `${heightPercentage}%`;
                    bar.querySelector('.bar-count').textContent = currentCount;
                    bar.setAttribute('data-count', currentCount); // Update data attribute for CSS

                    // Add 'active' class if count is not zero to ensure count text is visible
                    if (currentCount > 0) {
                        bar.classList.add('active');
                    } else {
                        bar.classList.remove('active');
                    }
                }
            }
            totalRollsDisplay.textContent = totalRolls;
        }

        // --- NEW VALIDATION FUNCTIONS ---

        // Function to validate a single die input and update its visual state
        function validateDieValue(inputElement) {
            let value = parseInt(inputElement.value);
            let isValid = true;

            // Check if input is empty or not a number, mark as invalid for button enablement
            if (inputElement.value === '' || isNaN(value)) {
                isValid = false;
            } 
            // If it's a number but out of range, "snap" it to the nearest valid value
            else if (value < 1) {
                inputElement.value = 1; // Correct to 1
                isValid = true; // Now it's valid
            } else if (value > 6) {
                inputElement.value = 6; // Correct to 6
                isValid = true; // Now it's valid
            }

            // Apply/remove invalid-input class for visual feedback
            if (!isValid) {
                inputElement.classList.add('invalid-input');
            } else {
                inputElement.classList.remove('invalid-input');
            }
            
            checkRollButtonState(); // Update the state of the "Add Roll" button
        }

        // Function to check both inputs and enable/disable the roll button
        function checkRollButtonState() {
            const die1 = parseInt(die1Input.value);
            const die2 = parseInt(die2Input.value);

            // True if die1 is a number between 1 and 6
            const isDie1Valid = !isNaN(die1) && die1 >= 1 && die1 <= 6;
            // True if die2 is a number between 1 and 6
            const isDie2Valid = !isNaN(die2) && die2 >= 1 && die2 <= 6;

            // Enable button only if both are valid
            rollButton.disabled = !(isDie1Valid && isDie2Valid);
        }

        // --- END NEW VALIDATION FUNCTIONS ---


        // Function to handle a new roll submission
        function handleRoll() {
            const die1 = parseInt(die1Input.value);
            const die2 = parseInt(die2Input.value);

            // Final validation check before processing (should mostly be handled by button.disabled)
            if (isNaN(die1) || isNaN(die2) || die1 < 1 || die1 > 6 || die2 < 1 || die2 > 6) {
                alert('בבקשה הזינו מספרים תקינים בין 1 ל-6 עבור כל קוביה.');
                return;
            }

            const sum = die1 + die2;
            rollCounts[sum]++;
            totalRolls++;

            renderChart();

            // Clear inputs after successful roll
            die1Input.value = '';
            die2Input.value = '';
            die1Input.focus(); // Keep focus on first input for convenience
            checkRollButtonState(); // Re-check button state after clearing inputs
        }

        // Function to reset all data with confirmation
        function resetChart() {
            if (confirm('האם אתם בטוחים שברצונכם לאפס את כל נתוני הזריקות? פעולה זו אינה הפיכה.')) {
                rollCounts.fill(0);
                totalRolls = 0;
                renderChart();
                alert('הנתונים אופסו בהצלחה!');
                die1Input.value = '';
                die2Input.value = '';
                die1Input.focus();
                checkRollButtonState(); // Re-check button state after reset
            } else {
                alert('איפוס הנתונים בוטל.');
            }
        }

        // Event Listeners
        rollButton.addEventListener('click', handleRoll);
        resetButton.addEventListener('click', resetChart);

        // Add input event listeners for live validation and button state update
        die1Input.addEventListener('input', () => validateDieValue(die1Input));
        die2Input.addEventListener('input', () => validateDieValue(die2Input));
        
        // Also validate on blur (when user clicks/tabs away) to catch final states
        die1Input.addEventListener('blur', () => validateDieValue(die1Input));
        die2Input.addEventListener('blur', () => validateDieValue(die2Input));


        // Allow pressing Enter key in input fields to trigger roll
        die1Input.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !rollButton.disabled) { // Only if button is enabled
                e.preventDefault(); 
                handleRoll();
            }
        });
        die2Input.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !rollButton.disabled) { // Only if button is enabled
                e.preventDefault();
                handleRoll();
            }
        });

        // Initial setup on page load
        document.addEventListener('DOMContentLoaded', () => {
            createChartBars();
            renderChart(); // Render initial empty chart
            checkRollButtonState(); // Set initial button state (should be disabled as inputs are empty)
        });

    </script>
</body>
</html>
